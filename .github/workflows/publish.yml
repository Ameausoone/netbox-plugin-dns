name: PyPI Publish

on:
    release:
        types:
          - published

permissions:
    contents: read

jobs:
    publish:
        runs-on: ubuntu-latest
        environment: NetBox DNS Deployment

        steps:
          - name: Checkout code
            uses: actions/checkout@main

          - name: Setup Python
            uses: actions/setup-python@main
            with:
              python-version: "3.12"

          - name: Install build dependencies
            run: |
                python -m pip install --upgrade pip
                pip install build

          - name: Build package
            run: python -m build

          - name: Publish to PyPI
            uses: pypa/gh-action-pypi-publish@release/v1
            with:
                verbose: true
                repository_url: ${{ vars.REPOSITORY_URL }}
                user: ${{ vars.USER }}
                password: ${{ secrets.PYPI_TOKEN }}
